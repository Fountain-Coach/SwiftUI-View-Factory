name: Dockerize the FastAPI service
goal: |
  Create a working docker-compose.yml and Dockerfile that allow running the FastAPI app locally
  as well as in CI. Assume FastAPI is located under app/ and started via `uvicorn app.main:app`.

steps:
  - name: Write Dockerfile for FastAPI
    file: Dockerfile
    lang: docker
    content: |
      FROM python:3.11-slim
      WORKDIR /code
      COPY requirements.txt .
      RUN pip install --no-cache-dir -r requirements.txt
      COPY app/ app/
      CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]

  - name: Write docker-compose.yml
    file: docker-compose.yml
    lang: yaml
    content: |
      version: "3.9"
      services:
        fastapi-app:
          build: .
          ports:
            - "8000:8000"
          environment:
            - OPENAI_API_KEY=${OPENAI_API_KEY}
          volumes:
            - .:/code
          command: uvicorn app.main:app --host 0.0.0.0 --port 8000

  - name: Explain usage
    file: .codex/README.md
    lang: markdown
    content: |
      # Docker Guide

      Run locally with:

      ```bash
      docker compose up --build
      ```

      Then visit http://localhost:8000/docs to view the API.

      The service expects an `OPENAI_API_KEY` either in your shell or in a `.env` file.

      You can also use this docker-compose.yml in CI for headless testing.
